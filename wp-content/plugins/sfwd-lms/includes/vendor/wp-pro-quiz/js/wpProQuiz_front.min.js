!function(e){e.wpProQuizFront=function(i,t){function o(){var e=0,i=-1,t=0,o=!1;this.questionStart=function(t){-1!=i&&this.questionStop(),i=t,e=+new Date},this.questionStop=function(){-1!=i&&(a[i].time+=Math.round((new Date-e)/1e3),i=-1)},this.startQuiz=function(){o&&this.stopQuiz(),t=+new Date,o=!0},this.stopQuiz=function(){o&&(a.comp.quizTime+=Math.round((new Date-t)/1e3),o=!1)},this.init=function(){}}var n=e(i),s=t,r=this,a=new Object,u=new Object,d=0,c=null,p=[],l="",h=!1,f=1,w=0,m=null,Q={randomAnswer:0,randomQuestion:0,disabledAnswerMark:0,checkBeforeStart:0,preview:0,cors:0,isAddAutomatic:0,quizSummeryHide:0,skipButton:0,reviewQustion:0,autoStart:0,forcingQuestionSolve:0,hideQuestionPositionOverview:0,formActivated:0,maxShowQuestion:0,sortCategories:0},z={isQuizStart:0,isLocked:0,loadLock:0,isPrerequisite:0,isUserStartLocked:0},v={check:'input[name="check"]',next:'input[name="next"]',questionList:".wpProQuiz_questionList",skip:'input[name="skip"]',singlePageLeft:'input[name="wpProQuiz_pageLeft"]',singlePageRight:'input[name="wpProQuiz_pageRight"]'},_={back:n.find('input[name="back"]'),next:n.find(v.next),quiz:n.find(".wpProQuiz_quiz"),questionList:n.find(".wpProQuiz_list"),results:n.find(".wpProQuiz_results"),sending:n.find(".wpProQuiz_sending"),quizStartPage:n.find(".wpProQuiz_text"),timelimit:n.find(".wpProQuiz_time_limit"),toplistShowInButton:n.find(".wpProQuiz_toplistShowInButton"),listItems:e()},P={token:"",isUser:0},g={START:0,END:1},q=function(){var i=s.timelimit,t=0,o={},n="ldadv-time-limit-"+s.user_id+"-"+s.quizId;return o.stop=function(){i&&(e.removeCookie(n),window.clearInterval(t),_.timelimit.hide())},o.start=function(){if(i){e.cookie.raw=!0;var s=1e3*i,a=e.cookie(n),u=a?a:i,d=1e3*u,c=_.timelimit.find("span").text(r.methode.parseTime(u)),p=_.timelimit.find(".wpProQuiz_progress");_.timelimit.show();var l=+new Date;t=window.setInterval(function(){var i=+new Date-l,t=d-i;i>=500&&(a=t/1e3,c.text(r.methode.parseTime(Math.ceil(a))),e.cookie(n,a)),p.css("width",t/s*100+"%"),0>=t&&(o.stop(),r.methode.finishQuiz(!0))},16)}},o}(),k=new function(){function i(e){var i=c.eq(e),t=i.offset().top,o=a.offset().top,n=t-o;if(0>n-4||n+32>100){var s=o-c.eq(0).offset().top-(o-d.offset().top)+i.position().top;s>w&&(s=w);var r=s/h;d.attr("style","margin-top: "+-s+"px !important"),u.css({top:r})}}function t(e){var i="",t=m[e];t.review?i="#FFB800":t.solved&&(i="#6CA54C"),c.eq(e).css("background-color",i)}function o(e){e.preventDefault();var i=e.pageY-l;0>i&&(i=0),i>p&&(i=p);var t=h*i;d.attr("style","margin-top: "+-t+"px !important"),u.css({top:i})}function s(i){i.preventDefault(),e(document).unbind(".scrollEvent")}var a=[],u=[],d=[],c=[],p=0,l=0,h=0,f=0,w=0,m=[];this.init=function(){a=n.find(".wpProQuiz_reviewQuestion"),u=a.find("div"),d=a.find("ol"),c=d.children(),u.mousedown(function(i){i.preventDefault(),i.stopPropagation(),l=i.pageY-u.offset().top+f,e(document).bind("mouseup.scrollEvent",s),e(document).bind("mousemove.scrollEvent",o)}),c.click(function(i){r.methode.showQuestion(e(this).index())}),n.bind("questionSolved",function(e){m[e.values.index].solved=e.values.solved,t(e.values.index)}),n.bind("changeQuestion",function(e){c.removeClass("wpProQuiz_reviewQuestionTarget"),c.eq(e.values.index).addClass("wpProQuiz_reviewQuestionTarget"),i(e.values.index)}),n.bind("reviewQuestion",function(e){m[e.values.index].review=!m[e.values.index].review,t(e.values.index)}),a.bind("mousewheel DOMMouseScroll",function(e){e.preventDefault();var i=e.originalEvent,t=i.wheelDelta?-i.wheelDelta/120:i.detail/3,o=20*t,n=f-d.offset().top+o;n>w&&(n=w),0>n&&(n=0);var s=n/h;return d.attr("style","margin-top: "+-n+"px !important"),u.css({top:s}),!1})},this.show=function(e){if(Q.reviewQustion&&a.parent().show(),n.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").show(),!e){d.attr("style","margin-top: 0px !important"),u.css({top:0});var i=d.outerHeight(),t=a.height();p=t-u.height(),l=0,w=i-t,h=w/p,this.reset(),i>100&&u.show(),f=u.offset().top}},this.hide=function(){a.parent().hide()},this.toggle=function(){if(Q.reviewQustion){a.parent().toggle(),c.removeClass("wpProQuiz_reviewQuestionTarget"),n.find(".wpProQuiz_reviewDiv .wpProQuiz_button2").hide(),d.attr("style","margin-top: 0px !important"),u.css({top:0});var e=d.outerHeight(),i=a.height();p=i-u.height(),l=0,w=e-i,h=w/p,e>100&&u.show(),f=u.offset().top}},this.reset=function(){for(var e=0,i=c.length;i>e;e++)m[e]={};c.removeClass("wpProQuiz_reviewQuestionTarget").css("background-color","")}},x=new o,S=function(i,t,o,n){var s={},a={singleMulti:function(){var i=n.find(".wpProQuiz_questionInput").attr("disabled","disabled");n.children().each(function(t){var o=e(this),n=o.data("pos"),r=i.eq(t).is(":checked");s[n]=r})},sort_answer:function(){var i=n.children();i.each(function(i,t){var o=e(this);s[i]=o.data("pos")}),n.sortable("destroy")},matrix_sort_answer:function(){{var i=n.children();new Array}statistcAnswerData={0:-1},i.each(function(){var i=e(this),t=i.data("pos"),o=i.find(".wpProQuiz_maxtrixSortCriterion"),n=o.children();n.length&&(statistcAnswerData[n.data("pos")]=t),s=statistcAnswerData}),o.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable("destroy")},free_answer:function(){var e=n.children(),i=e.find(".wpProQuiz_questionInput").attr("disabled","disabled").val();s=i},cloze_answer:function(){s={},n.find(".wpProQuiz_cloze").each(function(i,t){var o=e(this),n=o.children(),a=n.eq(0),u=(n.eq(1),r.methode.cleanupCurlyQuotes(a.val()));s[i]=u,a.attr("disabled","disabled")})},assessment_answer:function(){correct=!0;var i=n.find(".wpProQuiz_questionInput").attr("disabled","disabled"),t=0;i.filter(":checked").each(function(){t+=parseInt(e(this).val())}),s=t}};return a[i](),{response:s}},b=new function(){var i={isEmpty:function(i){return i=e.trim(i),!i||0===i.length}},t={TEXT:0,TEXTAREA:1,NUMBER:2,CHECKBOX:3,EMAIL:4,YES_NO:5,DATE:6,SELECT:7,RADIO:8};this.checkForm=function(){var o=!0;return n.find(".wpProQuiz_forms input, .wpProQuiz_forms textarea, .wpProQuiz_forms .wpProQuiz_formFields, .wpProQuiz_forms select").each(function(){var n=e(this),s=1==n.data("required"),r=n.data("type"),a=!0,u=e.trim(n.val());switch(r){case t.TEXT:case t.TEXTAREA:case t.SELECT:s&&(a=!i.isEmpty(u));break;case t.NUMBER:(s||!i.isEmpty(u))&&(a=!i.isEmpty(u)&&!isNaN(u));break;case t.EMAIL:(s||!i.isEmpty(u))&&(a=!i.isEmpty(u)&&new RegExp(/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/).test(u));break;case t.CHECKBOX:s&&(a=n.is(":checked"));break;case t.YES_NO:case t.RADIO:s&&(a=void 0!==n.find('input[type="radio"]:checked').val());break;case t.DATE:var d=0,c=0;n.find("select").each(function(){d++,c+=i.isEmpty(e(this).val())?0:1}),(s||c>0)&&(a=d==c)}a?n.siblings(".wpProQuiz_invalidate").hide():(o=!1,n.siblings(".wpProQuiz_invalidate").show())}),o},this.getFormData=function(){var i={};return n.find(".wpProQuiz_forms input, .wpProQuiz_forms textarea, .wpProQuiz_forms .wpProQuiz_formFields, .wpProQuiz_forms select").each(function(){var o=e(this),n=o.data("form_id"),s=o.data("type");switch(s){case t.TEXT:case t.TEXTAREA:case t.SELECT:case t.NUMBER:case t.EMAIL:i[n]=o.val();break;case t.CHECKBOX:i[n]=o.is(":checked")?1:0;break;case t.YES_NO:case t.RADIO:i[n]=o.find('input[type="radio"]:checked').val();break;case t.DATE:i[n]={day:o.find('select[name="wpProQuiz_field_'+n+'_day"]').val(),month:o.find('select[name="wpProQuiz_field_'+n+'_month"]').val(),year:o.find('select[name="wpProQuiz_field_'+n+'_year"]').val()}}}),i}},y=function(i){n.find(".wpProQuiz_questionList").each(function(){var t=e(this),o=t.data("question_id"),n=t.data("type"),s={};if("single"==n||"multiple"==n)t.find(".wpProQuiz_questionListItem").each(function(){s[e(this).data("pos")]=+e(this).find(".wpProQuiz_questionInput").is(":checked")});else if("free_answer"==n)s[0]=t.find(".wpProQuiz_questionInput").val();else{if("sort_answer"==n)return!0;if("matrix_sort_answer"==n)return!0;if("cloze_answer"==n){var r=0;t.find(".wpProQuiz_cloze input").each(function(){s[r++]=e(this).val()})}else"assessment_answer"==n&&(s[0]="",t.find(".wpProQuiz_questionInput:checked").each(function(){s[e(this).data("index")]=e(this).val()}))}i[o].data=s})};r.methode={parseBitOptions:function(){if(s.bo){Q.randomAnswer=1&s.bo,Q.randomQuestion=2&s.bo,Q.disabledAnswerMark=4&s.bo,Q.checkBeforeStart=8&s.bo,Q.preview=16&s.bo,Q.isAddAutomatic=64&s.bo,Q.reviewQustion=128&s.bo,Q.quizSummeryHide=256&s.bo,Q.skipButton=512&s.bo,Q.autoStart=1024&s.bo,Q.forcingQuestionSolve=2048&s.bo,Q.hideQuestionPositionOverview=4096&s.bo,Q.formActivated=8192&s.bo,Q.maxShowQuestion=16384&s.bo,Q.sortCategories=32768&s.bo;var e=32&s.bo;e&&void 0!=jQuery.support&&void 0!=jQuery.support.cors&&0==jQuery.support.cors&&(Q.cors=e)}},setClozeStyle:function(){n.find(".wpProQuiz_cloze input").each(function(){for(var i=e(this),t="",o=i.data("wordlen"),n=0;o>n;n++)t+="w";var s=e(document.createElement("span")).css("visibility","hidden").text(t).appendTo(e("body")),r=s.width();s.remove(),i.width(r+5)})},parseTime:function(e){var i=parseInt(e%60),t=parseInt(e/60%60),o=parseInt(e/3600%24);return i=(i>9?"":"0")+i,t=(t>9?"":"0")+t,o=(o>9?"":"0")+o,o+":"+t+":"+i},cleanupCurlyQuotes:function(i){return i=i.replace(/\u2018/,"'"),i=i.replace(/\u2019/,"'"),i=i.replace(/\u201C/,'"'),i=i.replace(/\u201D/,'"'),e.trim(i).toLowerCase()},resetMatrix:function(i){i.each(function(){var i=e(this),t=i.find(".wpProQuiz_sortStringList");i.find(".wpProQuiz_sortStringItem").each(function(){t.append(e(this))})})},marker:function(e,i){Q.disabledAnswerMark||e.addClass(i?"wpProQuiz_answerCorrect":"wpProQuiz_answerIncorrect")},startQuiz:function(i){if(z.loadLock)return void(z.isQuizStart=1);if(z.isQuizStart=0,z.isLocked)return _.quizStartPage.hide(),void n.find(".wpProQuiz_lock").show();if(z.isPrerequisite)return _.quizStartPage.hide(),void n.find(".wpProQuiz_prerequisite").show();if(z.isUserStartLocked)return _.quizStartPage.hide(),void n.find(".wpProQuiz_startOnlyRegisteredUser").show();if(Q.maxShowQuestion&&!i){if(s.formPos==g.START&&!b.checkForm())return;return _.quizStartPage.hide(),n.find(".wpProQuiz_loadQuiz").show(),void r.methode.loadQuizDataAjax(!0)}if(!Q.formActivated||s.formPos!=g.START||b.checkForm()){switch(r.methode.loadQuizData(),Q.randomQuestion&&r.methode.random(_.questionList),Q.randomAnswer&&r.methode.random(n.find(v.questionList)),Q.sortCategories&&r.methode.sortCategories(),r.methode.random(n.find(".wpProQuiz_sortStringList")),r.methode.random(n.find('[data-type="sort_answer"]')),n.find(".wpProQuiz_listItem").each(function(i,t){var o=e(this);o.find(".wpProQuiz_question_page span:eq(0)").text(i+1),o.find("> h5 span").text(i+1),o.find(".wpProQuiz_questionListItem").each(function(i,t){e(this).find("> span:not(.wpProQuiz_cloze)").text(i+1+". ")})}),_.next=n.find(v.next),s.mode){case 3:n.find('input[name="checkSingle"]').show();break;case 2:n.find(v.check).show(),!Q.skipButton&&Q.reviewQustion&&n.find(v.skip).show();break;case 1:n.find('input[name="back"]').slice(1).show();case 0:_.next.show()}(Q.hideQuestionPositionOverview||3==s.mode)&&n.find(".wpProQuiz_question_page").hide();var o=_.next.last();l=o.val(),o.val(s.lbn);var h=_.questionList.children();if(_.listItems=n.find(".wpProQuiz_list > li"),3==s.mode)r.methode.showSinglePage(0);else{c=h.eq(0).show();var f=c.find(v.questionList).data("question_id");x.questionStart(f)}x.startQuiz(),n.find(".wpProQuiz_sortable").parents("ul").sortable({update:function(i,t){var o=e(this).parents(".wpProQuiz_listItem");n.trigger({type:"questionSolved",values:{item:o,index:o.index(),solved:!0}})}}).disableSelection(),n.find(".wpProQuiz_sortStringList, .wpProQuiz_maxtrixSortCriterion").sortable({connectWith:".wpProQuiz_maxtrixSortCriterion:not(:has(li)), .wpProQuiz_sortStringList",placeholder:"wpProQuiz_placehold",update:function(i,t){var o=e(this).parents(".wpProQuiz_listItem");n.trigger({type:"questionSolved",values:{item:o,index:o.index(),solved:!0}})}}).disableSelection(),p=[],q.start(),d=+new Date,a={comp:{points:0,correctQuestions:0,quizTime:0}},n.find(".wpProQuiz_questionList").each(function(){var i=e(this).data("question_id");a[i]={time:0}}),u={},e.each(t.catPoints,function(e,i){u[e]=0}),_.quizStartPage.hide(),n.find(".wpProQuiz_loadQuiz").hide(),_.quiz.show(),k.show(),3!=s.mode&&n.trigger({type:"changeQuestion",values:{item:c,index:c.index()}})}},showSingleQuestion:function(e){var i=e?Math.ceil(e/s.qpp):1;this.showSinglePage(i)},showSinglePage:function(e){if($listItem=_.questionList.children().hide(),!s.qpp)return void $listItem.show();e=e?+e:1;var i=Math.ceil(n.find(".wpProQuiz_list > li").length/s.qpp);if(!(e>i)){var t=n.find(v.singlePageLeft).hide(),o=n.find(v.singlePageRight).hide(),a=n.find('input[name="checkSingle"]').hide();e>1&&t.val(t.data("text").replace(/%d/,e-1)).show(),e==i?a.show():o.val(o.data("text").replace(/%d/,e+1)).show(),f=e;var u=s.qpp*(e-1);$listItem.slice(u,u+s.qpp).show(),r.methode.scrollTo(_.quiz)}},nextQuestion:function(){jQuery(".mejs-pause").trigger("click"),this.showQuestionObject(c.next())},prevQuestion:function(){this.showQuestionObject(c.prev())},showQuestion:function(e){var i=_.listItems.eq(e);return 3==s.mode||h?(s.qpp&&r.methode.showSingleQuestion(e+1),r.methode.scrollTo(i,1),void x.startQuiz()):void this.showQuestionObject(i)},showQuestionObject:function(e){if(!e.length&&Q.forcingQuestionSolve&&Q.quizSummeryHide&&Q.reviewQustion)for(var i=0,t=n.find(".wpProQuiz_listItem").length;t>i;i++)if(!p[i])return alert(WpProQuizGlobal.questionsNotSolved),!1;if(c.hide(),c=e.show(),r.methode.scrollTo(_.quiz),n.trigger({type:"changeQuestion",values:{item:c,index:c.index()}}),c.length){var o=c.find(v.questionList).data("question_id");x.questionStart(o)}else r.methode.showQuizSummary()},skipQuestion:function(){n.trigger({type:"skipQuestion",values:{item:c,index:c.index()}}),r.methode.nextQuestion()},reviewQuestion:function(){n.trigger({type:"reviewQuestion",values:{item:c,index:c.index()}})},showQuizSummary:function(){if(x.questionStop(),x.stopQuiz(),Q.quizSummeryHide||!Q.reviewQustion)return void(Q.formActivated&&s.formPos==g.END?(k.hide(),_.quiz.hide(),r.methode.scrollTo(n.find(".wpProQuiz_infopage").show())):r.methode.finishQuiz());var i=n.find(".wpProQuiz_checkPage");i.find("ol:eq(0)").empty().append(n.find(".wpProQuiz_reviewQuestion ol li").clone().removeClass("wpProQuiz_reviewQuestionTarget")).children().click(function(t){i.hide(),_.quiz.show(),k.show(!0),r.methode.showQuestion(e(this).index())});for(var t=0,o=0,a=p.length;a>o;o++)p[o]&&t++;i.find("span:eq(0)").text(t),k.hide(),_.quiz.hide(),i.show(),r.methode.scrollTo(i)},finishQuiz:function(e){x.questionStop(),x.stopQuiz(),q.stop();var i=(+new Date-d)/1e3;i=s.timelimit&&i>s.timelimit?s.timelimit:i,w=i,n.find(".wpProQuiz_quiz_time span").text(r.methode.parseTime(i)),e&&_.results.find(".wpProQuiz_time_limit_expired").show(),r.methode.checkQuestion(_.questionList.children(),!0)},finishQuizEnd:function(){n.find(".wpProQuiz_correct_answer").text(a.comp.correctQuestions),a.comp.result=Math.round(a.comp.points/s.globalPoints*100*100)/100,"undefined"!=typeof certificate_details&&void 0!=certificate_details.certificateLink&&""!=certificate_details.certificateLink&&a.comp.result>=100*certificate_details.certificate_threshold&&n.find(".wpProQuiz_certificate").show(),"undefined"!=typeof continue_details&&n.find(".quiz_continue_link").html(continue_details),$pointFields=n.find(".wpProQuiz_points span"),$pointFields.eq(0).text(a.comp.points),$pointFields.eq(1).text(s.globalPoints),$pointFields.eq(2).text(a.comp.result+"%"),n.find(".wpProQuiz_resultsList > li").eq(r.methode.findResultIndex(a.comp.result)).show(),r.methode.setAverageResult(a.comp.result,!1),this.setCategoryOverview(),r.methode.sendCompletedQuiz(),Q.isAddAutomatic&&P.isUser&&r.methode.addToplist(),k.hide(),n.find(".wpProQuiz_checkPage, .wpProQuiz_infopage").hide(),_.quiz.hide()},sending:function(e,i,t){_.sending.show();var o,n=_.sending.find(".sending_progress_bar");if(o=void 0==typeof e||null==e?parseInt(100*n.width()/n.offsetParent().width())+156:e,void 0==i)var i=80;void 0==t&&(t=1),null!=m&&void 0!=typeof m&&clearInterval(m),m=setInterval(function(){var e=parseInt(100*n.width()/n.offsetParent().width());e>=i&&(clearInterval(m),e>=100&&setTimeout(r.methode.showResults(),2e3)),n.css("width",o+"%"),o+=t},300)},showResults:function(){_.sending.hide(),_.results.show(),r.methode.scrollTo(_.results)},setCategoryOverview:function(){a.comp.cats={},n.find(".wpProQuiz_catOverview li").each(function(){var i=e(this),t=i.data("category_id");if(void 0===s.catPoints[t])return i.hide(),!0;var o=Math.round(u[t]/s.catPoints[t]*100*100)/100;a.comp.cats[t]=o,i.find(".wpProQuiz_catPercent").text(o+"%"),i.show()})},questionSolved:function(e){p[e.values.index]=e.values.solved},sendCompletedQuiz:function(){if(!Q.preview){y(a);var e=b.getFormData();jQuery.post(WpProQuizGlobal.ajaxurl,{action:"wp_pro_quiz_completed_quiz",quiz:s.quiz,quizId:s.quizId,results:a,timespent:w,forms:e}).success(function(e){r.methode.sending(null,100,15)})}},findResultIndex:function(e){for(var i=s.resultsGrade,t=-1,o=999999,n=0;n<i.length;n++){var r=i[n];e>=r&&o>e-r&&(o=e-r,t=n)}return t},showQustionList:function(){h=!h,_.toplistShowInButton.hide(),_.quiz.toggle(),n.find(".wpProQuiz_QuestionButton").hide(),_.questionList.children().show(),k.toggle(),n.find(".wpProQuiz_question_page").hide()},random:function(i){i.each(function(){var i=e(this).children().get().sort(function(){return Math.round(Math.random())-.5});e(i).appendTo(i[0].parentNode)})},sortCategories:function(){var i=e(".wpProQuiz_list").children().get().sort(function(i,t){var o=e(i).find(".wpProQuiz_questionList").data("question_id"),n=e(t).find(".wpProQuiz_questionList").data("question_id");return s.json[o].catId-s.json[n].catId});e(i).appendTo(i[0].parentNode)},restartQuiz:function(){_.results.hide(),_.quizStartPage.show(),_.questionList.children().hide(),_.toplistShowInButton.hide(),k.hide(),n.find(".wpProQuiz_questionInput, .wpProQuiz_cloze input").removeAttr("disabled").removeAttr("checked").css("background-color",""),n.find('.wpProQuiz_questionListItem input[type="text"]').val(""),n.find(".wpProQuiz_answerCorrect, .wpProQuiz_answerIncorrect").removeClass("wpProQuiz_answerCorrect wpProQuiz_answerIncorrect"),n.find(".wpProQuiz_listItem").data("check",!1),n.find(".wpProQuiz_response").hide().children().hide(),r.methode.resetMatrix(n.find(".wpProQuiz_listItem")),n.find(".wpProQuiz_sortStringItem, .wpProQuiz_sortable").removeAttr("style"),n.find(".wpProQuiz_clozeCorrect, .wpProQuiz_QuestionButton, .wpProQuiz_resultsList > li").hide(),n.find('.wpProQuiz_question_page, input[name="tip"]').show(),n.find(".wpProQuiz_certificate").attr("style","display: none !important"),_.results.find(".wpProQuiz_time_limit_expired").hide(),_.next.last().val(l),h=!1},showSpinner:function(){n.find(".wpProQuiz_spinner").show()},hideSpinner:function(){n.find(".wpProQuiz_spinner").hide()},checkQuestion:function(i,t){var o=void 0==i?!1:!0,d={};i=void 0==i?c:i,i.each(function(){var i=e(this),t=i.find(v.questionList),o=t.data("question_id"),n=s.json[t.data("question_id")],r=n.type;return x.questionStop(),i.data("check")?!0:(("single"==n.type||"multiple"==n.type)&&(r="singleMulti"),void(d[o]=S(r,n,i,t)))}),s.checkAnswers={list:i,responses:d,endCheck:t,finishQuiz:o},o?r.methode.sending(1,80,3):r.methode.showSpinner(),r.methode.ajax({action:"ld_adv_quiz_pro_ajax",func:"checkAnswers",data:{quizId:s.quizId,responses:d}},function(i){r.methode.hideSpinner();var t=s.checkAnswers.list,o=(s.checkAnswers.responses,s.checkAnswers.r,s.checkAnswers.endCheck),d=s.checkAnswers.finishQuiz;t.each(function(){var t=e(this),d=t.find(v.questionList),c=d.data("question_id");if(t.data("check"))return!0;data=s.json[d.data("question_id")];var p=i[c];t.find(".wpProQuiz_response").show(),t.find(v.check).hide(),t.find(v.skip).hide(),t.find(v.next).show(),a[data.id].points=p.p,a[data.id].correct=Number(p.c),a[data.id].data=p.s,jQuery.isEmptyObject(a[data.id].data)&&(void 0==p.e.type||"sort_answer"!=p.e.type&&"matrix_sort_answer"!=p.e.type||(a[data.id].data=p.e.r)),a.comp.points+=p.p,u[data.catId]+=p.p,r.methode.markCorrectIncorrect(p,t,d),p.c?("undefined"!=typeof p.e.AnswerMessage&&t.find(".wpProQuiz_correct").find(".wpProQuiz_AnswerMessage").html(p.e.AnswerMessage),t.find(".wpProQuiz_correct").show(),a.comp.correctQuestions+=1):("undefined"!=typeof p.e.AnswerMessage&&t.find(".wpProQuiz_incorrect").find(".wpProQuiz_AnswerMessage").html(p.e.AnswerMessage),t.find(".wpProQuiz_incorrect").show()),t.find(".wpProQuiz_responsePoints").text(p.p),t.data("check",!0),o||n.trigger({type:"questionSolved",values:{item:t,index:t.index(),solved:!0}})}),d&&r.methode.finishQuizEnd()})},markCorrectIncorrect:function(i,t,o){if("undefined"!=typeof i.e.c)switch(i.e.type){case"single":case"multiple":o.children().each(function(t){var o=e(this),n=o.data("pos");i.e.c[n]?r.methode.marker(o,!0):!i.c&&i.e.r[n]&&r.methode.marker(o,!1)});break;case"free_answer":var n=o.children();i.c?r.methode.marker(n,!0):r.methode.marker(n,!1);break;case"cloze_answer":o.find(".wpProQuiz_cloze").each(function(t,o){{var n=e(this),s=n.children(),a=s.eq(0),u=s.eq(1);r.methode.cleanupCurlyQuotes(a.val())}i.s[t]?a.css("background-color","#B0DAB0"):(a.css("background-color","#FFBABA"),"undefined"!=typeof i.e.c[t]&&(u.html("("+i.e.c[t].join()+")"),u.show())),a.attr("disabled","disabled")});break;case"sort_answer":var s=o.children();s.each(function(t,o){var n=e(this);i.e.c[t]==n.data("pos")?r.methode.marker(n,!0):r.methode.marker(n,!1)}),s.children().css({"box-shadow":"0 0",cursor:"auto"});var a=new Array;jQuery.each(i.e.c,function(e,i){a[i]=e}),s.sort(function(i,t){return a[e(i).data("pos")]>a[e(t).data("pos")]?1:-1}),o.append(s);break;case"matrix_sort_answer":var s=o.children(),u=new Array;statistcAnswerData={0:-1},s.each(function(){var t=e(this),o=(t.data("pos"),t.find(".wpProQuiz_maxtrixSortCriterion")),n=o.children(),s=n.data("pos");n.length&&i.e.c[s]==t.data("pos")?r.methode.marker(t,!0):r.methode.marker(t,!1),u[s]=o}),r.methode.resetMatrix(t),t.find(".wpProQuiz_sortStringItem").each(function(){var i=u[e(this).data("pos")];void 0!=i&&i.append(this)}).css({"box-shadow":"0 0",cursor:"auto"})}},showTip:function(){var i=e(this),t=i.siblings(".wpProQuiz_question").find(v.questionList).data("question_id");i.siblings(".wpProQuiz_tipp").toggle("fast"),a[t].tip=1,e(document).bind("mouseup.tipEvent",function(i){var t=n.find(".wpProQuiz_tipp"),o=n.find('input[name="tip"]');t.is(i.target)||0!=t.has(i.target).length||o.is(i.target)||(t.hide("fast"),e(document).unbind(".tipEvent"))})},ajax:function(i,t,o){o=o||"json",Q.cors&&(jQuery.support.cors=!0),e.post(WpProQuizGlobal.ajaxurl+"?XDEBUG_SESSION_START=sublime.xdebug",i,t,o),Q.cors&&(jQuery.support.cors=!1)},checkQuizLock:function(){z.loadLock=1,r.methode.ajax({action:"wp_pro_quiz_check_lock",quizId:s.quizId},function(e){void 0!=e.lock&&(z.isLocked=e.lock.is,e.lock.pre&&n.find('input[name="restartQuiz"]').hide()),void 0!=e.prerequisite&&(z.isPrerequisite=1,n.find(".wpProQuiz_prerequisite span").text(e.prerequisite)),void 0!=e.startUserLock&&(z.isUserStartLocked=e.startUserLock),z.loadLock=0,z.isQuizStart&&r.methode.startQuiz()})},loadQuizData:function(){r.methode.ajax({action:"wp_pro_quiz_load_quiz_data",quizId:s.quizId},function(e){e.toplist&&r.methode.handleToplistData(e.toplist),void 0!=e.averageResult&&r.methode.setAverageResult(e.averageResult,!0)})},setAverageResult:function(e,i){var t=n.find(".wpProQuiz_resultValue:eq("+(i?0:1)+") > * ");t.eq(1).text(e+"%"),t.eq(0).css("width",240*e/100+"px")},handleToplistData:function(e){var i=n.find(".wpProQuiz_addToplist"),t=i.find(".wpProQuiz_addBox").show().children("div");if(e.canAdd)if(i.show(),i.find(".wpProQuiz_addToplistMessage").hide(),i.find(".wpProQuiz_toplistButton").show(),P.token=e.token,P.isUser=0,e.userId)t.hide(),P.isUser=1,Q.isAddAutomatic&&i.hide();else{t.show();var o=t.children().eq(1);e.captcha?(o.find('input[name="wpProQuiz_captchaPrefix"]').val(e.captcha.code),o.find(".wpProQuiz_captchaImg").attr("src",e.captcha.img),o.find('input[name="wpProQuiz_captcha"]').val(""),o.show()):o.hide()}else i.hide()},scrollTo:function(i,t){var o=i.offset().top-100;(t||(window.pageYOffset||document.body.scrollTop)>o)&&e("html,body").animate({scrollTop:o},300)},addToplist:function(){if(!Q.preview){var e=n.find(".wpProQuiz_addToplistMessage").text(WpProQuizGlobal.loadData).show(),i=n.find(".wpProQuiz_addBox").hide();r.methode.ajax({action:"wp_pro_quiz_add_toplist",quizId:s.quizId,token:P.token,name:i.find('input[name="wpProQuiz_toplistName"]').val(),email:i.find('input[name="wpProQuiz_toplistEmail"]').val(),captcha:i.find('input[name="wpProQuiz_captcha"]').val(),prefix:i.find('input[name="wpProQuiz_captchaPrefix"]').val(),points:a.comp.points,totalPoints:s.globalPoints,timespent:w},function(t){e.text(t.text),t.clear?(i.hide(),r.methode.updateToplist()):i.show(),t.captcha&&(i.find(".wpProQuiz_captchaImg").attr("src",t.captcha.img),i.find('input[name="wpProQuiz_captchaPrefix"]').val(t.captcha.code),i.find('input[name="wpProQuiz_captcha"]').val(""))})}},updateToplist:function(){"function"==typeof wpProQuiz_fetchToplist&&wpProQuiz_fetchToplist()},registerSolved:function(){n.find('.wpProQuiz_questionInput[type="text"]').change(function(i){var t=e(this),o=t.parents(".wpProQuiz_listItem"),s=!1;""!=t.val()&&(s=!0),n.trigger({type:"questionSolved",values:{item:o,index:o.index(),solved:s}})}),n.find('.wpProQuiz_questionList[data-type="single"] .wpProQuiz_questionInput, .wpProQuiz_questionList[data-type="assessment_answer"] .wpProQuiz_questionInput').change(function(i){var t=e(this),o=t.parents(".wpProQuiz_listItem"),s=this.checked;n.trigger({type:"questionSolved",values:{item:o,index:o.index(),solved:s}})}),n.find(".wpProQuiz_cloze input").change(function(){var i=e(this),t=i.parents(".wpProQuiz_listItem"),o=!0;t.find(".wpProQuiz_cloze input").each(function(){return""==e(this).val()?(o=!1,!1):void 0}),n.trigger({type:"questionSolved",values:{item:t,index:t.index(),solved:o}})}),n.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').change(function(i){var t=e(this),o=t.parents(".wpProQuiz_listItem"),s=0;o.find('.wpProQuiz_questionList[data-type="multiple"] .wpProQuiz_questionInput').each(function(e){this.checked&&s++}),n.trigger({type:"questionSolved",values:{item:o,index:o.index(),solved:s?!0:!1}})})},loadQuizDataAjax:function(i){r.methode.ajax({action:"wp_pro_quiz_admin_ajax",func:"quizLoadData",data:{quizId:s.quizId}},function(t){s.globalPoints=t.globalPoints,s.catPoints=t.catPoints,s.json=t.json,_.quiz.remove(),n.find(".wpProQuiz_quizAnker").after(t.content),_={back:n.find('input[name="back"]'),next:n.find(v.next),quiz:n.find(".wpProQuiz_quiz"),questionList:n.find(".wpProQuiz_list"),results:n.find(".wpProQuiz_results"),sending:n.find(".wpProQuiz_sending"),quizStartPage:n.find(".wpProQuiz_text"),timelimit:n.find(".wpProQuiz_time_limit"),toplistShowInButton:n.find(".wpProQuiz_toplistShowInButton"),listItems:e()},r.methode.initQuiz(),i&&r.methode.startQuiz(!0);var o=t.content,a=o.search("wp-audio-shortcode"),u=o.search("wp-video-shortcode");("-1"!=a||"-1"!=u)&&(e.getScript(t.site_url+"/wp-includes/js/mediaelement/mediaelement-and-player.min.js"),e.getScript(t.site_url+"/wp-includes/js/mediaelement/wp-mediaelement.js"),e("<link/>",{rel:"stylesheet",type:"text/css",href:t.site_url+"/wp-includes/js/mediaelement/mediaelementplayer.min.css"}).appendTo("head"))})},initQuiz:function(){r.methode.setClozeStyle(),r.methode.registerSolved(),_.next.click(function(){return!Q.forcingQuestionSolve||p[c.index()]||!Q.quizSummeryHide&&Q.reviewQustion?void r.methode.nextQuestion():(alert(WpProQuizGlobal.questionNotSolved),!1)}),_.back.click(function(){r.methode.prevQuestion()}),n.find(v.check).click(function(){return!Q.forcingQuestionSolve||p[c.index()]||!Q.quizSummeryHide&&Q.reviewQustion?void r.methode.checkQuestion():(alert(WpProQuizGlobal.questionNotSolved),!1)}),n.find('input[name="checkSingle"]').click(function(){if(Q.forcingQuestionSolve&&(Q.quizSummeryHide||!Q.reviewQustion))for(var e=0,i=n.find(".wpProQuiz_listItem").length;i>e;e++)if(!p[e])return alert(WpProQuizGlobal.questionsNotSolved),!1;r.methode.showQuizSummary()}),n.find('input[name="tip"]').click(r.methode.showTip),n.find('input[name="skip"]').click(r.methode.skipQuestion),n.find('input[name="wpProQuiz_pageLeft"]').click(function(){r.methode.showSinglePage(f-1)}),n.find('input[name="wpProQuiz_pageRight"]').click(function(){r.methode.showSinglePage(f+1)})}},r.preInit=function(){r.methode.parseBitOptions(),k.init(),n.find('input[name="startQuiz"]').click(function(){return r.methode.startQuiz(),!1}),Q.checkBeforeStart&&!Q.preview&&r.methode.checkQuizLock(),n.find('input[name="reShowQuestion"]').click(function(){r.methode.showQustionList()}),n.find('input[name="restartQuiz"]').click(function(){r.methode.restartQuiz()}),n.find('input[name="review"]').click(r.methode.reviewQuestion),n.find('input[name="wpProQuiz_toplistAdd"]').click(r.methode.addToplist),n.find('input[name="quizSummary"]').click(r.methode.showQuizSummary),n.find('input[name="endQuizSummary"]').click(function(){if(Q.forcingQuestionSolve)for(var e=0,i=n.find(".wpProQuiz_listItem").length;i>e;e++)if(!p[e])return alert(WpProQuizGlobal.questionsNotSolved),!1;(!Q.formActivated||s.formPos!=g.END||b.checkForm())&&r.methode.finishQuiz()}),n.find('input[name="endInfopage"]').click(function(){b.checkForm()&&r.methode.finishQuiz()}),n.find('input[name="showToplist"]').click(function(){_.quiz.hide(),_.toplistShowInButton.toggle()}),n.bind("questionSolved",r.methode.questionSolved),Q.maxShowQuestion||r.methode.initQuiz(),Q.autoStart&&r.methode.startQuiz()},r.preInit()},e.fn.wpProQuizFront=function(i){return this.each(function(){void 0==e(this).data("wpProQuizFront")&&e(this).data("wpProQuizFront",new e.wpProQuizFront(this,i))})}}(jQuery);